<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>글로벌 EV 모터 시장 분석 대시보드</title>
    <link rel="stylesheet" href="/src/frontend/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="/src/frontend/js/chartEvents.js"></script>
    <script src="/src/frontend/js/chartManager.js"></script>
    <script src="/src/frontend/js/visualizations.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Noto Sans KR', sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            line-height: 1.6;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 3.5em;
            font-weight: 700;
            margin-bottom: 16px;
            color: #ffffff;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.2em;
            color: #a8a8a8;
            font-weight: 400;
        }

        .auto-update-status {
            background-color: #2b2b2b;
            color: #f0f0f0;
            padding: 16px 24px;
            border-radius: 16px;
            margin: 20px auto;
            text-align: center;
            max-width: 600px;
            font-size: 0.95em;
            border: 1px solid #444;
        }

        .update-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 12px;
            background: #30d158;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.4; }
        }

        .countdown-timer {
            font-weight: 600;
            color: #ff9f0a;
        }

        .last-update-info {
            text-align: center;
            color: #a8a8a8;
            margin: 16px auto;
            font-size: 0.9em;
        }

        .filter-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .filter-tab {
            background-color: #2b2b2b;
            color: #f0f0f0;
            border: 1px solid #444;
            padding: 12px 24px;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.95em;
        }

        .filter-tab:hover {
            background-color: #3d3d3d;
            transform: translateY(-1px);
        }

        .filter-tab.active {
            background-color: #007aff;
            border-color: #007aff;
            color: white;
            transform: translateY(-1px);
        }
        
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 32px;
            margin-bottom: 40px;
        }

        .news-item {
            background-color: #2b2b2b;
            border-radius: 20px;
            padding: 32px;
            border: 1px solid #444;
            transition: all 0.4s;
            position: relative;
            cursor: pointer;
        }

        .news-item:hover {
            background-color: #3d3d3d;
            border-color: #666;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .news-item a {
            text-decoration: none;
            color: inherit;
        }

        .news-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .news-badge.breaking {
            background-color: rgba(255, 59, 48, 0.15);
            color: #ff453a;
            border: 1px solid rgba(255, 59, 48, 0.3);
            animation: pulse 2s infinite;
        }

        .news-badge.tech {
            background-color: rgba(175, 82, 222, 0.15);
            color: #bf5af2;
            border: 1px solid rgba(175, 82, 222, 0.3);
        }

        .news-badge.market {
            background-color: rgba(48, 209, 88, 0.15);
            color: #30d158;
            border: 1px solid rgba(48, 209, 88, 0.3);
        }

        .news-badge.korea {
            background-color: rgba(255, 159, 10, 0.15);
            color: #ff9f0a;
            border: 1px solid rgba(255, 159, 10, 0.3);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .news-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 16px;
            color: #f2f2f7;
            line-height: 1.3;
            letter-spacing: -0.01em;
        }

        .news-summary {
            color: #a8a8a8;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1em;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #8e8e93;
            border-top: 1px solid #444;
            padding-top: 20px;
        }

        .news-source {
            font-weight: 600;
            color: #007aff;
        }

        .news-date {
            font-style: italic;
        }

        .more-btn, .back-btn {
            display: block;
            margin: 50px auto;
            padding: 16px 32px;
            background-color: #2b2b2b;
            color: #f2f2f7;
            border: 1px solid #444;
            border-radius: 24px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .more-btn:hover, .back-btn:hover {
            background-color: #3d3d3d;
            border-color: #666;
            transform: translateY(-2px);
        }

        .back-btn {
            margin-bottom: 32px;
        }

        .hidden {
            display: none;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 50px;
            margin-bottom: 60px;
            margin-top: 40px;
        }
        
        .card {
            background-color: #2b2b2b;
            border-radius: 20px;
            padding: 32px;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

        .card:hover {
            background-color: #3d3d3d;
            border-color: #666;
            transform: translateY(-2px);
        }

        .card h3 {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: #f2f2f7;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 12px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 16px 0;
            padding: 16px;
            background-color: #3d3d3d;
            border-radius: 12px;
        }

        .metric-label {
            font-weight: 500;
            color: #a8a8a8;
        }

        .metric-value {
            font-weight: 600;
            color: #007aff;
            font-size: 1.1em;
        }

        .trend-up {
            color: #30d158;
        }

        .trend-down {
            color: #ff453a;
        }

        .chart-container {
            height: 300px;
            margin: 40px 0 60px 0;
            padding-bottom: 40px;
        }

        .source {
            font-size: 0.8em;
            color: #8e8e93;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #444;
        }

        .source a {
            color: #007aff;
            text-decoration: none;
        }

        .source a:hover {
            text-decoration: underline;
        }

        .large-card {
            grid-column: 1 / -1;
        }

        .tech-item {
            background-color: #3d3d3d;
            padding: 20px;
            margin: 16px 0;
            border-radius: 12px;
            border-left: 3px solid #bf5af2;
        }

        .tech-item h4 {
            margin-bottom: 12px;
            font-size: 1.1em;
            color: #f2f2f7;
        }

        .tech-item p {
            font-size: 0.95em;
            color: #a8a8a8;
        }

        .insight-item {
            background-color: #3d3d3d;
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            border-left: 3px solid #007aff;
            color: #a8a8a8;
        }

        .regional-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .region-card {
            background-color: #3d3d3d;
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            border: 1px solid #555;
        }

        .region-card h4 {
            margin-bottom: 12px;
            color: #f2f2f7;
            font-size: 0.9em;
        }

        .region-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #30d158;
        }

        .growth-rate {
            font-size: 0.85em;
            margin-top: 8px;
            color: #a8a8a8;
        }

        .market-growth-visualization {
            padding: 20px 0 40px 0;
            margin-bottom: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .chart-title {
            font-size: 1.1em;
            color: #f2f2f7;
            font-weight: 600;
        }

        .chart-period {
            font-size: 0.9em;
            color: #8e8e93;
        }

        .growth-bars {
            display: flex;
            justify-content: space-between;
            align-items: end;
            height: 200px;
            margin-top: 8px;
            margin-bottom: 20px;
            padding: 0 10px 10px 10px;
            position: relative;
            min-height: 220px;
        }

        .year-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 80px;
            position: relative;
            margin-bottom: 10px;
        }

        .year-bar .bar {
            width: 100%;
            max-width: 40px;
            background: linear-gradient(180deg, #007aff 0%, #0056d3 100%);
            border-radius: 4px 4px 0 0;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            min-height: 10px;
        }

        .year-bar.current-year .bar {
            background: linear-gradient(180deg, #30d158 0%, #248a3d 100%);
            box-shadow: 0 0 15px rgba(48, 209, 88, 0.4);
        }

        .year-bar.target-year .bar {
            background: linear-gradient(180deg, #ff9f0a 0%, #d48806 100%);
            box-shadow: 0 0 15px rgba(255, 159, 10, 0.4);
        }

        .year-bar:hover .bar {
            transform: scaleY(1.05);
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.3);
        }

        .year-bar {
            position: relative;
            cursor: pointer;
        }

        .year-bar::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-bottom: 5px;
            border: 1px solid #444;
        }

        .year-bar:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .year-bar .year {
            /* Hidden to prevent overlap with the next section. We'll show years on the line chart dots instead. */
            display: none;
        }

        .year-bar .value {
            display: none;
        }

        .year-bar.current-year .year,
        .year-bar.current-year .value {
            color: #30d158;
            font-weight: 600;
        }

        .year-bar.target-year .year,
        .year-bar.target-year .value {
            color: #ff9f0a;
            font-weight: 600;
        }

        .growth-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #444;
        }

        .growth-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #3d3d3d;
            padding: 16px;
            border-radius: 12px;
        }

        .growth-metric .label {
            font-size: 0.95em;
            color: #a8a8a8;
            font-weight: 500;
        }

        .growth-metric .value {
            font-size: 1.2em;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .dashboard {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .news-item, .card {
                padding: 24px;
            }
            
            .filter-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .growth-bars {
                height: 150px;
                padding: 0 5px 10px 5px;
                margin-bottom: 20px;
                min-height: 160px;
            }

            .year-bar {
                max-width: 60px;
            }

            .year-bar .bar {
                max-width: 30px;
            }

            .year-bar .year,
            .year-bar .value {
                display: none;
            }

            .growth-info {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>EV Motor Market Intelligence</h1>
            <p>글로벌 전기차 모터 산업 핵심 인사이트 & 동향</p>
        </div>
        
        <div class="auto-update-status">
            <span class="update-indicator"></span>
            자동 업데이트: 매시간 (06:00-23:00 KST) | 다음 업데이트까지 <span class="countdown-timer" id="countdown"></span>
        </div>

        <div class="last-update-info">
            마지막 업데이트: <span id="lastUpdate">2025. 09. 14. 06:00 (KST)</span>
        </div>

        <div class="grid">
            <div class="card large-card">
                <h3>📊 글로벌 EV 시장 현황 (2024-2025)</h3>
                <div class="regional-data">
                    <div class="region-card">
                        <h4>글로벌 판매량</h4>
                        <div class="region-value">17M</div>
                        <div class="growth-rate trend-up">+25% (2024)</div>
                    </div>
                    <div class="region-card">
                        <h4>중국 시장</h4>
                        <div class="region-value">11M</div>
                        <div class="growth-rate">최대 시장</div>
                    </div>
                    <div class="region-card">
                        <h4>시장 규모</h4>
                        <div class="region-value">$1.3T</div>
                        <div class="growth-rate trend-up">→ $6.5T (2030)</div>
                    </div>
                    <div class="region-card">
                        <h4>연평균 성장률</h4>
                        <div class="region-value">32.5%</div>
                        <div class="growth-rate">(2025-2030)</div>
                    </div>
                </div>
                <div class="source">
                    출처: <a href="https://www.iea.org/reports/global-ev-outlook-2025" target="_blank">IEA Global EV Outlook 2025</a>,
                    <a href="https://www.grandviewresearch.com/industry-analysis/electric-vehicles-ev-market" target="_blank">Grand View Research</a>
                </div>
            </div>

            <div class="card">
                <h3>🔋 EV 모터 시장 규모</h3>
                <div class="metric">
                    <span class="metric-label">2025년 시장 규모</span>
                    <span class="metric-value trend-up">$27.16B</span>
                </div>
                <div class="metric">
                    <span class="metric-label">2032년 예상 규모</span>
                    <span class="metric-value trend-up">$77.61B</span>
                </div>
                <div class="metric">
                    <span class="metric-label">연평균 성장률 (CAGR)</span>
                    <span class="metric-value trend-up">16.2%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">아시아태평양 점유율</span>
                    <span class="metric-value">52.91%</span>
                </div>
                <div class="source">
                    출처: <a href="https://www.fortunebusinessinsights.com/electric-vehicle-motor-market-107244" target="_blank">Fortune Business Insights</a>
                </div>
            </div>

            <div class="card">
                <h3>🧲 PMSM 시장 동향</h3>
                <div class="metric">
                    <span class="metric-label">2024년 시장 규모</span>
                    <span class="metric-value">$27.01B</span>
                </div>
                <div class="metric">
                    <span class="metric-label">2025년 예상 규모</span>
                    <span class="metric-value trend-up">$28.83B</span>
                </div>
                <div class="metric">
                    <span class="metric-label">2029년 예상 규모</span>
                    <span class="metric-value trend-up">$40.4B</span>
                </div>
                <div class="metric">
                    <span class="metric-label">연평균 성장률</span>
                    <span class="metric-value trend-up">8.4%</span>
                </div>
                <div class="source">
                    출처: <a href="https://www.thebusinessresearchcompany.com/report/permanent-magnet-synchronous-motor-global-market-report" target="_blank">The Business Research Company</a>
                </div>
            </div>
        </div>

        <div class="filter-tabs">
            <div class="filter-tab active" data-filter="all">전체</div>
            <div class="filter-tab" data-filter="breaking">속보</div>
            <div class="filter-tab" data-filter="tech">기술혁신</div>
            <div class="filter-tab" data-filter="market">시장동향</div>
            <div class="filter-tab" data-filter="korea">국내뉴스</div>
        </div>

        <div class="news-grid" id="newsGrid">
            <!-- News items will be dynamically populated here -->
        </div>
        
        <button class="more-btn" id="moreBtn">더 많은 뉴스 보기</button>

        <div class="card large-card">
            <h3>🚀 핵심 기술 트렌드</h3>
            <div id="techTrendsContainer">
                <!-- Tech trends will be dynamically populated here -->
            </div>
        </div>

        <div class="card large-card">
            <h3>💡 전략적 인사이트</h3>
            <div id="marketInsightsContainer">
                <!-- Market insights will be dynamically populated here -->
            </div>
        </div>

        <div class="card large-card">
            <h3>📈 EV 모터 시장 성장 예측</h3>
            <div class="chart-container">
                <canvas id="marketChart" style="display: none;"></canvas>
                <div id="marketGrowthChart" class="market-growth-visualization">
                    <div class="chart-header">
                        <span class="chart-title">시장 규모 (억 달러)</span>
                        <span class="chart-period">2022-2032</span>
                    </div>
                    <div class="growth-bars">
                        <div class="year-bar" data-year="2022" data-value="192" data-tooltip="$19.2B">
                            <div class="bar" style="height: 25%;"></div>
                            <span class="year">2022</span>
                            <span class="value">$19.2B</span>
                        </div>
                        <div class="year-bar" data-year="2023" data-value="225" data-tooltip="$22.5B">
                            <div class="bar" style="height: 29%;"></div>
                            <span class="year">2023</span>
                            <span class="value">$22.5B</span>
                        </div>
                        <div class="year-bar" data-year="2024" data-value="270" data-tooltip="$27.0B">
                            <div class="bar" style="height: 35%;"></div>
                            <span class="year">2024</span>
                            <span class="value">$27.0B</span>
                        </div>
                        <div class="year-bar current-year" data-year="2025" data-value="272" data-tooltip="$27.16B (현재)">
                            <div class="bar" style="height: 35%;"></div>
                            <span class="year">2025</span>
                            <span class="value">$27.16B</span>
                        </div>
                        <div class="year-bar" data-year="2026" data-value="310" data-tooltip="$31.0B">
                            <div class="bar" style="height: 40%;"></div>
                            <span class="year">2026</span>
                            <span class="value">$31.0B</span>
                        </div>
                        <div class="year-bar" data-year="2028" data-value="431" data-tooltip="$43.1B">
                            <div class="bar" style="height: 56%;"></div>
                            <span class="year">2028</span>
                            <span class="value">$43.1B</span>
                        </div>
                        <div class="year-bar" data-year="2030" data-value="601" data-tooltip="$60.1B">
                            <div class="bar" style="height: 78%;"></div>
                            <span class="year">2030</span>
                            <span class="value">$60.1B</span>
                        </div>
                        <div class="year-bar target-year" data-year="2032" data-value="776" data-tooltip="$77.61B (목표)">
                            <div class="bar" style="height: 100%;"></div>
                            <span class="year">2032</span>
                            <span class="value">$77.61B</span>
                        </div>
                    </div>
                    <div class="growth-info">
                        <div class="growth-metric">
                            <span class="label">연평균 성장률 (CAGR)</span>
                            <span class="value trend-up">16.2%</span>
                        </div>
                        <div class="growth-metric">
                            <span class="label">2025-2032 예상 성장</span>
                            <span class="value trend-up">+185%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="marketForecastContainer">
                <div class="source">
                    출처: <a href="https://www.fortunebusinessinsights.com/electric-vehicle-motor-market-107244" target="_blank">Fortune Business Insights</a>, 
                    <a href="https://www.thebusinessresearchcompany.com/report/permanent-magnet-synchronous-motor-global-market-report" target="_blank">The Business Research Company</a>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>🌏 지역별 시장 현황</h3>
            <div class="metric">
                <span class="metric-label">중국 EV 판매량</span>
                <span class="metric-value trend-up">11M+ (2024)</span>
            </div>
            <div class="metric">
                <span class="metric-label">유럽 EV 수출량</span>
                <span class="metric-value trend-up">830K (+9%)</span>
            </div>
            <div class="metric">
                <span class="metric-label">한국 시장 성장률</span>
                <span class="metric-value trend-up">11.7% (2024)</span>
            </div>
            <div class="source">
                출처: <a href="https://www.iea.org/reports/global-ev-outlook-2025" target="_blank">IEA Global EV Outlook 2025</a>
            </div>
        </div>
        
    </div>
    
    <script>
        // Load news data from JSON file
        async function loadNews() {
            try {
                const response = await fetch('data/news.json');
                if (!response.ok) {
                    throw new Error('Failed to load news data');
                }
                const data = await response.json();
                
                document.getElementById('lastUpdate').textContent = 
                    new Date(data.lastUpdated).toLocaleString('ko-KR', { 
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    }) + ' (KST)';
                
                renderNews('all', data.articles);
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('newsGrid').innerHTML = `
                    <div class="card">
                        <h3>뉴스를 불러오는데 실패했습니다</h3>
                        <p>잠시 후 다시 시도해주세요.</p>
                    </div>
                `;
            }
        }

        let visibleCount = 6;
        let currentFilter = 'all';
        let currentArticles = [];

        const newsGrid = document.getElementById('newsGrid');
        const moreBtn = document.getElementById('moreBtn');
        const filterTabs = document.querySelectorAll('.filter-tab');

        // News card creation function
        const createNewsCard = (item) => {
            const newsItem = document.createElement('div');
            newsItem.className = 'news-item';
            newsItem.dataset.category = item.category;
            
            const categoryText = {
                'breaking': '속보',
                'tech': '기술혁신',
                'market': '시장동향',
                'korea': '국내뉴스'
            }[item.category];
            
            newsItem.innerHTML = `
                <a href="${item.url}" target="_blank">
                    <span class="news-badge ${item.category}">${categoryText}</span>
                    <h2 class="news-title">${item.title_kr || item.title}</h2>
                    <p class="news-summary">${item.summary_kr || item.summary}</p>
                    <div class="news-meta">
                        <span class="news-source">${item.source}</span>
                        <span class="news-date">${item.date}</span>
                    </div>
                </a>
            `;
            return newsItem;
        };

        // News rendering function
        const renderNews = (filter, articles) => {
            currentArticles = articles;
            newsGrid.innerHTML = '';
            const filteredNews = articles.filter(item => filter === 'all' || item.category === filter);
            
            const newsToShow = filteredNews.slice(0, visibleCount);
            newsToShow.forEach(item => {
                const card = createNewsCard(item);
                newsGrid.appendChild(card);
            });
            
            moreBtn.style.display = visibleCount >= filteredNews.length ? 'none' : 'block';
        };

        // Filter tab click events
        filterTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                filterTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFilter = tab.dataset.filter;
                visibleCount = 6;
                renderNews(currentFilter, currentArticles);
            });
        });

        // More button click event
        moreBtn.addEventListener('click', () => {
            visibleCount += 6;
            renderNews(currentFilter, currentArticles);
        });

        // Update tech trends
        function updateTechTrends(trends) {
            const container = document.getElementById('techTrendsContainer');
            container.innerHTML = trends.map(trend => `
                <div class="tech-item">
                    <h4>${trend.keyword}</h4>
                    <p>${trend.summary}</p>
                </div>
            `).join('');
        }

        // Update market insights
        function updateMarketInsights(insights) {
            const container = document.getElementById('marketInsightsContainer');
            container.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <strong>${insight.title}:</strong> ${insight.content}
                </div>
            `).join('');
        }

        // Update market forecast
        function updateMarketForecast(forecast) {
            const container = document.getElementById('marketForecastContainer');
            
            // Update chart data if forecast data is available
            if (forecast.current.size && forecast.future.size) {
                const chart = Chart.getChart("marketChart");
                const years = [];
                const data = [];
                
                // Generate yearly data points
                const startYear = new Date().getFullYear();
                const endYear = forecast.future.year;
                const yearDiff = endYear - startYear;
                
                for (let i = 0; i <= yearDiff; i++) {
                    const year = startYear + i;
                    years.push(year.toString());
                    
                    // Calculate projected value using CAGR
                    if (forecast.cagr) {
                        const value = forecast.current.size * Math.pow(1 + forecast.cagr/100, i);
                        data.push(parseFloat(value.toFixed(2)));
                    }
                }
                
                chart.data.labels = years;
                chart.data.datasets[0].data = data;
                chart.update();
            }

            // Update source info
            container.innerHTML = `
                <div class="source">
                    현재 시장 규모: ${forecast.current.size || 'N/A'}<br>
                    ${forecast.future.year}년 예상 규모: ${forecast.future.size || 'N/A'}<br>
                    연평균 성장률 (CAGR): ${forecast.cagr ? forecast.cagr + '%' : 'N/A'}
                </div>
            `;
        }

        // Enhanced news loading with insights
        async function loadNews() {
            try {
                const response = await fetch('data/news.json');
                if (!response.ok) {
                    throw new Error('Failed to load news data');
                }
                const data = await response.json();
                
                document.getElementById('lastUpdate').textContent = 
                    new Date(data.lastUpdated).toLocaleString('ko-KR', { 
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    }) + ' (KST)';
                
                renderNews('all', data.articles);

                // Update insights sections if available
                if (data.insights) {
                    if (data.insights.techTrends) {
                        updateTechTrends(data.insights.techTrends);
                    }
                    if (data.insights.marketInsights) {
                        updateMarketInsights(data.insights.marketInsights);
                    }
                    if (data.insights.marketForecast) {
                        updateMarketForecast(data.insights.marketForecast);
                    }
                }
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('newsGrid').innerHTML = `
                    <div class="card">
                        <h3>뉴스를 불러오는데 실패했습니다</h3>
                        <p>잠시 후 다시 시도해주세요.</p>
                    </div>
                `;
            }
        }

        // Initialize news loading
        loadNews();

        // Countdown timer
        function updateCountdown() {
            const now = new Date();
            const currentHour = now.getHours();
            
            // If outside 06:00-23:00, show time until 06:00
            if (currentHour < 6) {
                let target = new Date(now);
                target.setHours(6, 0, 0, 0);
                const timeRemaining = target - now;
                showCountdown(timeRemaining);
            } else if (currentHour >= 23) {
                let tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                tomorrow.setHours(6, 0, 0, 0);
                const timeRemaining = tomorrow - now;
                showCountdown(timeRemaining);
            } else {
                // During 06:00-23:00, show time until next hour
                let nextHour = new Date(now);
                nextHour.setHours(nextHour.getHours() + 1);
                nextHour.setMinutes(0, 0, 0);
                const timeRemaining = nextHour - now;
                showCountdown(timeRemaining);
            }
        }

        function showCountdown(timeRemaining) {
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Market Chart - Initialize after DOM is ready
        function initializeChart() {
            const fallback = document.getElementById('chartFallback');
            const canvas = document.getElementById('marketChart');
            
            try {
                if (!canvas) {
                    console.error('Chart canvas not found');
                    showChartFallback();
                    return;
                }

                const ctx = canvas.getContext('2d');
                if (!ctx) {
                    console.error('Canvas context not available');
                    showChartFallback();
                    return;
                }

                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js library not loaded');
                    showChartFallback();
                    setTimeout(initializeChart, 2000); // Retry after 2 seconds
                    return;
                }

                // Hide fallback and show canvas
                if (fallback) fallback.style.display = 'none';
                canvas.style.display = 'block';

                // Custom plugin to draw year badges above points
                const yearBadgePlugin = {
                    id: 'yearBadgePlugin',
                    afterDatasetsDraw(chart, args, pluginOptions) {
                        const { ctx } = chart;
                        const meta = chart.getDatasetMeta(0);
                        const labels = chart.data.labels || [];
                        const data = chart.data.datasets[0].data || [];
                        ctx.save();
                        ctx.font = '12px Roboto, \"Noto Sans KR\", sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';
                        labels.forEach((label, i) => {
                            const pt = meta.data[i];
                            if (!pt || !pt.x || !pt.y) return;
                            // Colors: default blue, green for 2025, orange for 2032
                            const year = String(label);
                            let bg = '#0a59d1'; // blue
                            if (year === '2025') bg = '#248a3d';
                            if (year === '2032') bg = '#d48806';
                            const text = year;
                            const paddingX = 6;
                            const paddingY = 3;
                            const radius = 6;
                            const yOffset = 14; // distance above point
                            const textWidth = ctx.measureText(text).width;
                            const boxW = textWidth + paddingX * 2;
                            const boxH = 20;
                            const x = pt.x - boxW / 2;
                            const y = pt.y - yOffset - boxH;
                            // rounded rect
                            ctx.fillStyle = bg;
                            ctx.beginPath();
                            ctx.moveTo(x + radius, y);
                            ctx.arcTo(x + boxW, y, x + boxW, y + boxH, radius);
                            ctx.arcTo(x + boxW, y + boxH, x, y + boxH, radius);
                            ctx.arcTo(x, y + boxH, x, y, radius);
                            ctx.arcTo(x, y, x + boxW, y, radius);
                            ctx.closePath();
                            ctx.fill();
                            // text
                            ctx.fillStyle = '#ffffff';
                            ctx.fillText(text, pt.x, y + boxH - paddingY);
                        });
                        ctx.restore();
                    }
                };

                // Precompute dot colors per year (blue default, green 2025, orange 2032)
                const labels = ['2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'];
                const pointColors = labels.map(y => y === '2025' ? '#30d158' : (y === '2032' ? '#ff9f0a' : '#007aff'));

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'EV 모터 시장 규모 (십억 달러)',
                            data: [19.2, 22.5, 27.0, 27.16, 31.0, 36.5, 43.1, 50.8, 60.1, 68.0, 77.61],
                            backgroundColor: 'rgba(0, 122, 255, 0.4)',
                            borderColor: 'rgba(0, 122, 255, 1)',
                            borderWidth: 2.5,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 5,
                            pointBackgroundColor: pointColors,
                            pointBorderColor: pointColors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: { top: 40 } },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#f0f0f0'
                                }
                            },
                            // register plugin through options for this instance
                            yearBadgePlugin: true,
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += '$' + context.parsed.y.toLocaleString() + 'B';
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#a8a8a8'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#a8a8a8',
                                    callback: function(value) {
                                        return '$' + value + 'B';
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    },
                    plugins: [yearBadgePlugin]
                });

                console.log('Chart initialized successfully');
            } catch (error) {
                console.error('Error initializing chart:', error);
                showChartFallback();
            }
        }

        function showChartFallback() {
            const fallback = document.getElementById('chartFallback');
            const canvas = document.getElementById('marketChart');
            
            if (fallback) {
                fallback.style.display = 'block';
                fallback.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <h4 style="color: #f2f2f7; margin-bottom: 20px;">📊 EV 모터 시장 성장 데이터</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 20px 0;">
                            <div style="background: #3d3d3d; padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.2em; color: #007aff; font-weight: bold;">2025년</div>
                                <div style="color: #a8a8a8;">$27.16B</div>
                            </div>
                            <div style="background: #3d3d3d; padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.2em; color: #007aff; font-weight: bold;">2032년</div>
                                <div style="color: #a8a8a8;">$77.61B</div>
                            </div>
                            <div style="background: #3d3d3d; padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.2em; color: #30d158; font-weight: bold;">CAGR</div>
                                <div style="color: #a8a8a8;">16.2%</div>
                            </div>
                        </div>
                        <p style="color: #8e8e93; font-size: 0.9em;">상세 차트는 잠시 후 표시됩니다</p>
                    </div>
                `;
            }
            
            if (canvas) {
                canvas.style.display = 'none';
            }
        }

        // Animate growth bars
        function animateGrowthBars() {
            const yearBars = document.querySelectorAll('.year-bar');
            const maxValue = 776; // Maximum value for 2032 ($77.61B)
            
            yearBars.forEach((yearBar, index) => {
                const bar = yearBar.querySelector('.bar');
                const value = parseInt(yearBar.getAttribute('data-value'));
                const heightPercentage = (value / maxValue) * 100;
                
                bar.style.height = '0';
                bar.style.opacity = '0';
                
                setTimeout(() => {
                    bar.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    bar.style.opacity = '1';
                    bar.style.height = heightPercentage + '%';
                }, index * 100);
            });
        }

        // Initialize visualizations
        function initializeVisualizations() {
            // Try to initialize Chart.js chart first
            initializeChart();
            
            // Always animate the CSS bars
            setTimeout(animateGrowthBars, 300);
        }

        // Initialize when everything is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initializeVisualizations, 500);
            });
        } else {
            setTimeout(initializeVisualizations, 500);
        }
    </script>
</body>
</html>